<div class="container">
  <nav class="sidenav">
    <div class="toolbar">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>

    <button
      class="role-button"
      [class.senior]="role === 'senior-specialist'"
      (click)="toggleRoleMenu()"
      aria-label="–ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    >
      <p>
        <strong>{{ role === 'senior-specialist' ? '–°—Ç–∞—Ä—à–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç' : '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç' }}</strong>
      </p>
      <span>{{ role === 'senior-specialist' ? 'üëë' : 'üë§' }}</span>
    </button>

    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é -->
    <div class="role-menu" *ngIf="isRoleMenuOpen()" (clickOutside)="isRoleMenuOpen.set(false)">
      <div class="role-menu-content">
        <button mat-stroked-button color="warn" (click)="logout()">–í—ã–π—Ç–∏</button>
      </div>
    </div>
  </nav>

  <main class="content-area">
    <!-- –í—Å—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <section class="top-section">
      <header class="header">
        <h1>–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ–ø–ª–∏—Ü</h1>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å: —Å–µ–ª–µ–∫—Ç—ã + –∏—Å—Ç–æ—Ä–∏—è -->
        <div class="header-main-layout">
          <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –≤—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –∏ —Ç–µ–ø–ª–∏—Ü—ã -->
          <div class="header-controls">
            <!-- –°–≤–µ—Ç–æ—Ñ–æ—Ä -->
            <app-status-widget
              class="status-widget-inline"
              [regionId]="selectedRegionId() ?? undefined"
              *ngIf="selectedRegionId(); else noRegionSelected"
            />
            <ng-template #noRegionSelected>
              <app-status-widget />
            </ng-template>
            <div class="dropdown">
              <label for="region-select">–†–µ–≥–∏–æ–Ω:</label>
              <select
                id="region-select"
                class="form-control"
                (change)="onRegionChange($event)"
                [value]="selectedRegionId() || ''"
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                @for (region of regions(); track region.id) {
                <option [value]="region.id">{{ region.name }}</option>
                }
              </select>
            </div>

            <div class="dropdown">
              <label for="greenhouse-select">–¢–µ–ø–ª–∏—Ü–∞:</label>
              <select
                id="greenhouse-select"
                class="form-control"
                (change)="onGreenhouseChange($event)"
                [disabled]="!selectedRegionId()"
                [value]="selectedGhId() || ''"
              >
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–ø–ª–∏—Ü—É</option>
                @for (gh of greenhousesByRegion(); track gh.id) {
                <option [value]="gh.id">{{ gh.name }}</option>
                }
              </select>
            </div>
          </div>

          <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –∏—Å—Ç–æ—Ä–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π -->
          @if (selectedGhId()) {
          <div class="history-sidebar expanded">
            <app-state-history [greenhouseId]="selectedGhId()!" />
          </div>
          }
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ç–µ–ø–ª–∏—Ü–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ -->
        @if (!selectedGhId()) {
        <div class="placeholder">
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–ø–ª–∏—Ü—É –∏–∑ —Å–ø–∏—Å–∫–∞</p>
        </div>
        }
      </header>
    </section>

    <!-- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å ‚Äî —Ç–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫ -->
    @if (selectedGhId()) {
    <section class="chart-section">
      <app-measurement-chart [greenhouseId]="selectedGhId()!" />
    </section>
    }
  </main>
</div>
